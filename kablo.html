<!DOCTYPE html>
<html lang="bg">
<head>    
    <meta charset="UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    
    <title>Most Pro - BG Archive</title>    
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>    
    <style>        
        body { background: #0a0a0a; color: #fff; text-align: center; font-family: 'Segoe UI', sans-serif; margin: 0; }
        .player-box { position: sticky; top: 0; background: #000; padding: 15px; border-bottom: 3px solid #00ff41; z-index: 1000; box-shadow: 0 4px 15px rgba(0, 255, 65, 0.3); }
        video { width: 100%; max-width: 800px; border-radius: 12px; background: #111; aspect-ratio: 16/9; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px; padding: 20px; }        
        button { background: #1a1a1a; color: #00ff41; border: 1px solid #00ff41; padding: 15px 5px; border-radius: 10px; cursor: pointer; transition: 0.3s; font-size: 13px; font-weight: bold; height: 60px; text-transform: uppercase; }        
        button:hover { background: #00ff41; color: #000; transform: scale(1.05); box-shadow: 0 0 15px #00ff41; }
        #status { font-size: 14px; color: #00ff41; margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>    

    <div class="player-box">        
        <div style="font-size: 22px; font-weight: 900; color: #00ff41; margin-bottom: 10px;">BG TV ARCHIVE</div>
        <video id="video" controls autoplay playsinline></video>
        <div id="status">Сканиране... (Taranıyor...)</div>
    </div>    

    <div id="buttons" class="grid"></div>

    <script>        
        const BASE_URL = "http://85.11.144.8/archive/";
        // CORS engelini aşmak için senin Worker'ı veya AllOrigins'i kullanıyoruz
        const PROXY = "https://api.allorigins.win/raw?url=";

        async function init() {            
            try {                
                const res = await fetch(PROXY + encodeURIComponent(BASE_URL));
                const text = await res.text();
                
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');
                const links = Array.from(doc.querySelectorAll('a'));
                
                const btnDiv = document.getElementById('buttons');
                btnDiv.innerHTML = '';
                
                links.forEach(link => {
                    const folder = link.getAttribute('href');
                    // Klasörleri ayıkla (genelde / ile biter)
                    if (folder && folder !== "../" && !folder.startsWith('?')) {
                        const channelName = folder.replace(/\//g, '');
                        const btn = document.createElement('button');
                        btn.innerText = channelName;
                        btn.onclick = () => playChannel(channelName);
                        btnDiv.appendChild(btn);
                    }
                });
                document.getElementById('status').innerText = "Изберете канал (Kanal Seçin)";
            } catch (e) { 
                document.getElementById('status').innerText = "Грешка при връзката!"; 
            }        
        }

        function playChannel(name) {            
            const video = document.getElementById('video');
            // Bu tür sunucularda yayın genelde kanal_adi.m3u8 olarak klasör içindedir
            const m3u8Url = `${BASE_URL}${name}/${name}.m3u8`;
            
            document.getElementById('status').innerText = "Пускане: " + name;

            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(m3u8Url);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
                
                hls.on(Hls.Events.ERROR, (event, data) => {
                    if (data.fatal) {
                        // Eğer isim/isim.m3u8 çalışmazsa direkt klasör içindeki tek dosyayı dene
                        video.src = `${BASE_URL}${name}/`; 
                        document.getElementById('status').innerText = "Грешка при този канал.";
                    }
                });
            } else {
                video.src = m3u8Url;
            }
        }        
        init();    
    </script>
</body>
</html>
