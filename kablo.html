<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV Most Pro - Kablo</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body { background: #0f0f0f; color: white; font-family: sans-serif; text-align: center; margin: 0; padding: 0; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; padding: 20px; }
        button { background: #1e1e1e; border: 1px solid #333; color: white; padding: 15px 5px; cursor: pointer; border-radius: 8px; font-size: 12px; height: 50px; }
        button:hover { background: #ff4500; border-color: #ff4500; }
        .video-box { position: sticky; top: 0; background: #0f0f0f; padding: 10px; z-index: 100; }
        video { width: 100%; max-width: 800px; background: black; border: 2px solid #ff4500; border-radius: 12px; }
    </style>
</head>
<body>

    <div class="video-box">
        <h3>IPTV Most Pro - KabloTV</h3>
        <video id="video" controls autoplay playsinline></video>
    </div>
    
    <div id="buttons" class="grid">Yükleniyor...</div>

    <script>
        const M3U_URL = "https://borutv.boncuuktv.workers.dev/kablotv.m3u";
        // Senin özel köprün
        const PROXY = "https://benim-koprum.efomost2.workers.dev/?url=";

        async function loadM3U() {
            try {
                const response = await fetch(M3U_URL);
                const data = await response.text();
                parseM3U(data);
            } catch (error) {
                document.getElementById('buttons').innerText = "Liste yüklenemedi!";
            }
        }

        function parseM3U(content) {
            const lines = content.split('\n');
            const buttonsDiv = document.getElementById('buttons');
            buttonsDiv.innerHTML = '';

            for (let i = 0; i < lines.length; i++) {
                if (lines[i].startsWith('#EXTINF')) {
                    const name = lines[i].split(',')[1] || "Kanal";
                    const url = lines[i + 1] ? lines[i + 1].trim() : "";
                    
                    if(url.startsWith('http')) {
                        const btn = document.createElement('button');
                        btn.innerText = name;
                        btn.onclick = () => playVideo(url);
                        buttonsDiv.appendChild(btn);
                    }
                }
            }
        }

        function playVideo(url) {
            const video = document.getElementById('video');
            // KRİTİK DÜZELTME: encodeURIComponent ekledik ki link bozulmasın
            const finalUrl = PROXY + encodeURIComponent(url); 

            console.log("Oynatılıyor: " + finalUrl);

            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(finalUrl);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = finalUrl;
            }
        }

        loadM3U();
    </script>
</body>
</html>
