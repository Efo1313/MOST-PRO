<!DOCTYPE html>
<html lang="bg">
<head>    
    <meta charset="UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    
    <title>Most Pro - BG Archive</title>    
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>    
    <style>        
        body { background: #000; color: #fff; text-align: center; font-family: 'Segoe UI', sans-serif; margin: 0; }
        .player-box { position: sticky; top: 0; background: #111; padding: 15px; border-bottom: 3px solid #00ff41; z-index: 1000; }
        video { width: 100%; max-width: 800px; border-radius: 10px; background: #000; box-shadow: 0 0 20px rgba(0, 255, 65, 0.4); }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; padding: 20px; }        
        button { background: #1a1a1a; color: #00ff41; border: 1px solid #00ff41; padding: 15px 5px; border-radius: 8px; cursor: pointer; transition: 0.3s; font-weight: bold; font-size: 14px; }        
        button:hover { background: #00ff41; color: #000; transform: scale(1.05); }
        #status { font-size: 14px; color: #00ff41; margin-top: 10px; font-weight: bold; text-transform: uppercase; }
    </style>
</head>
<body>    

    <div class="player-box">        
        <div style="font-size: 22px; font-weight: 900; color: #00ff41; margin-bottom: 10px;">BG TV ARCHIVE</div>
        <video id="video" controls autoplay playsinline></video>
        <div id="status">Сканиране на канали...</div>
    </div>    

    <div id="buttons" class="grid">Зареждане...</div>

    <script>        
        // Bulgaristan yerel IP adresi (Arşiv dizini)
        const ARCHIVE_URL = "http://85.11.144.8/archive/";
        
        // CORS engelini aşmak için AllOrigins proxy
        const PROXY = "https://api.allorigins.win/raw?url=";

        async function init() {            
            try {                
                // Sunucu dizinini tarıyoruz
                const res = await fetch(PROXY + encodeURIComponent(ARCHIVE_URL));
                const text = await res.text();
                
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');
                const links = Array.from(doc.querySelectorAll('a'));
                
                const btnDiv = document.getElementById('buttons');
                btnDiv.innerHTML = '';
                
                links.forEach(link => {
                    const folder = link.getAttribute('href');
                    // Klasörleri ayıkla (Örn: 1/, 2/, bTV/)
                    if (folder && folder !== "../" && !folder.startsWith('?')) {
                        const channelName = folder.replace(/\//g, '');
                        const btn = document.createElement('button');
                        btn.innerText = "CH " + channelName;
                        btn.onclick = () => playChannel(channelName);
                        btnDiv.appendChild(btn);
                    }
                });
                document.getElementById('status').innerText = "Изберете канал (Kanal Seçin)";
            } catch (e) { 
                document.getElementById('status').innerText = "Грешка при връзката (Bağlantı Hatası)"; 
            }        
        }

        function playChannel(id) {            
            const video = document.getElementById('video');
            // Sunucu yapısında genelde index.m3u8 veya mono.m3u8 bulunur
            const streamUrl = `${ARCHIVE_URL}${id}/index.m3u8`;
            
            document.getElementById('status').innerText = "Пускане: Kanal " + id;

            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(streamUrl);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
                
                // Hata durumunda alternatif dosya adını dene
                hls.on(Hls.Events.ERROR, (event, data) => {
                    if (data.fatal) {
                        hls.loadSource(`${ARCHIVE_URL}${id}/mono.m3u8`);
                    }
                });
            } else {
                video.src = streamUrl;
            }
        }        
        init();    
    </script>
</body>
</html>
