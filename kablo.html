<!DOCTYPE html>
<html lang="bg">
<head>    
    <meta charset="UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    
    <title>Most Pro - BG Archive</title>    
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>    
    <style>        
        body { background: #0a0f0d; color: #fff; text-align: center; font-family: sans-serif; margin: 0; }
        .player-box { position: sticky; top: 0; background: #0a0f0d; padding: 15px; border-bottom: 3px solid #00ff41; z-index: 1000; }
        video { width: 100%; max-width: 800px; border-radius: 10px; background: #000; box-shadow: 0 0 20px rgba(0, 255, 65, 0.2); }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; padding: 20px; }        
        button { background: #1a1a1a; color: #00ff41; border: 1px solid #00ff41; padding: 15px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }        
        button:hover { background: #00ff41; color: #000; transform: scale(1.05); }
        #status { font-size: 14px; color: #00ff41; margin-top: 10px; text-transform: uppercase; }
    </style>
</head>
<body>    

    <div class="player-box">        
        <h2 style="margin:0; color:#00ff41;">BG TV ARCHIVE <span style="color:#fff">PRO</span></h2>
        <video id="video" controls autoplay playsinline></video>
        <div id="status">Сканиране на архива... (Arşiv Taranıyor)</div>
    </div>    

    <div id="buttons" class="grid"></div>

    <script>        
        // Bulgaristan yerel arşiv sunucusu
        const BASE_URL = "http://85.11.144.8/archive/";
        // Tarayıcı engeline takılmamak için basit bir proxy ekleyelim
        const PROXY = "https://api.allorigins.win/raw?url=";

        async function scanArchive() {            
            try {                
                const res = await fetch(PROXY + encodeURIComponent(BASE_URL));
                const text = await res.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');
                const links = Array.from(doc.querySelectorAll('a'));
                
                const btnDiv = document.getElementById('buttons');
                btnDiv.innerHTML = '';
                
                links.forEach(link => {
                    const folderName = link.innerText.replace('/', '');
                    // Klasörleri (kanal isimlerini) ayıklıyoruz
                    if (folderName && !folderName.includes('Parent Directory')) {
                        const btn = document.createElement('button');
                        btn.innerText = folderName;
                        // Kanala tıklandığında içindeki canlı yayını (veya son kaydı) açar
                        btn.onclick = () => playChannel(folderName);
                        btnDiv.appendChild(btn);
                    }
                });
                document.getElementById('status').innerText = "Готов (Hazır)";
            } catch (e) { 
                document.getElementById('status').innerText = "Грешка при свързване (Bağlantı Hatası)";
            }        
        }

        function playChannel(channel) {            
            const video = document.getElementById('video');
            // Arşiv sunucularında genelde kanal_adı/index.m3u8 veya kanal_adı.m3u8 olur
            const streamUrl = `${BASE_URL}${channel}/${channel}.m3u8`;
            
            document.getElementById('status').innerText = "Зареждане: " + channel;

            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(streamUrl);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
                hls.on(Hls.Events.ERROR, () => {
                    // Eğer kanal/kanal.m3u8 çalışmazsa direkt klasörü dene
                    video.src = `${BASE_URL}${channel}/index.m3u8`;
                });
            } else {
                video.src = streamUrl;
            }
        }        
        scanArchive();    
    </script>
</body>
</html>
