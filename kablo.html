<!DOCTYPE html>
<html lang="tr">
<head>    
    <meta charset="UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    
    <title>IPTV Most Pro - Final</title>    
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>    
    <style>        
        body { background: #000; color: #fff; text-align: center; font-family: 'Segoe UI', sans-serif; margin: 0; }
        .player-box { position: sticky; top: 0; background: #000; padding: 10px; border-bottom: 2px solid #ff4500; z-index: 999; }
        video { width: 100%; max-width: 700px; border-radius: 8px; box-shadow: 0 0 15px rgba(255, 69, 0, 0.5); background: #111; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; padding: 20px; }        
        button { background: #1a1a1a; color: #fff; border: 1px solid #333; padding: 15px 5px; border-radius: 8px; cursor: pointer; transition: 0.3s; font-size: 13px; font-weight: bold; height: 65px; display: flex; align-items: center; justify-content: center; }        
        button:hover { background: #ff4500; border-color: #fff; transform: scale(1.05); }
        #status { font-size: 14px; color: #ff4500; margin: 10px; font-weight: bold; }
    </style>
</head>
<body>    

    <div class="player-box">        
        <h2 style="margin: 5px 0; font-size: 18px; color: #ff4500;">IPTV MOST PRO</h2>
        <video id="video" controls autoplay playsinline></video>
        <div id="status">Kanal Seçiniz...</div>
    </div>    

    <div id="buttons" class="grid">Kanallar Hazırlanıyor...</div>

    <script>        
        // 1. BoruTV Listesi (Eğer VPN'siz çalışmazsa otomatik hata verir)
        const M3U_URL = "https://borutv.boncuuktv.workers.dev/kablotv.m3u";        
        
        // 2. Senin Köprün (Linkleri temizleyip Bulgaristan'a taşımaya yardımcı olur)
        const PROXY = "https://benim-koprum.efomost2.workers.dev/?url=";

        async function load() {            
            try {                
                const res = await fetch(M3U_URL);                
                const text = await res.text();                
                parseM3U(text);
            } catch (e) { 
                document.getElementById('status').innerText = "Liste yüklenemedi! Farklı bir kaynak deneniyor...";
                // Eğer BoruTV listesi hiç gelmezse yasal listeyi yükle
                loadBackup();
            }        
        }

        async function loadBackup() {
            const res = await fetch("https://iptv-org.github.io/iptv/countries/tr.m3u");
            const text = await res.text();
            parseM3U(text);
        }

        function parseM3U(content) {
            const lines = content.split('\n');
            const btnDiv = document.getElementById('buttons');
            btnDiv.innerHTML = '';

            for (let i = 0; i < lines.length; i++) {
                if (lines[i].startsWith('#EXTINF')) {
                    const name = lines[i].split(',')[1] || "Kanal";
                    const url = lines[i+1]?.trim();
                    if (url && url.startsWith('http')) {
                        const btn = document.createElement('button');
                        btn.innerText = name;
                        btn.onclick = () => play(url, name);
                        btnDiv.appendChild(btn);
                    }
                }
            }
            document.getElementById('status').innerText = "Liste Hazır! İyi Seyirler.";
        }

        function play(url, name) {            
            const video = document.getElementById('video');
            document.getElementById('status').innerText = "Açılıyor: " + name;
            
            // Önce Proxy ile deniyoruz, eğer link zaten şifreliyse Proxy zorunludur
            const finalUrl = url.includes('kablowebtv') ? PROXY + encodeURIComponent(url) : url;

            if (Hls.isSupported()) {
                const hls = new Hls({
                    manifestLoadingMaxRetry: 2,
                    levelLoadingMaxRetry: 2
                });
                hls.loadSource(finalUrl);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
                
                hls.on(Hls.Events.ERROR, (event, data) => {
                    if (data.fatal) {
                        document.getElementById('status').innerText = "Hata: Yayın bölgenize kapalı olabilir.";
                    }
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {                
                video.src = finalUrl;            
            }        
        }        
        load();    
    </script>
</body>
</html>
